name: release
on:
  push:
    tags:
      - 'v*.*.*'
jobs:
  build-android:
    uses: ./.github/workflows/build-android.yml
    secrets: inherit
  build-ios:
    uses: ./.github/workflows/build-ios.yml
    secrets: inherit
  gh-release:
    needs: [build-android, build-ios]
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/download-artifact@v4
        with:
          name: android-artifacts
          path: android-artifacts
      - uses: actions/download-artifact@v4
        with:
          name: ios-artifacts
          path: ios-artifacts
      - run: |
          files=$(find android-artifacts ios-artifacts -type f \( \
            -name '*.apk' -o -name '*.aab' -o -name '*.ipa' -o \
            -name '*.bundle' -o -name '*.jsbundle' -o -name '*.map' -o -name '*.txt' \))
          gh release create "${GITHUB_REF_NAME}" --draft --generate-notes --title "${GITHUB_REF_NAME#v}" $files
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
